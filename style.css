/* ============================
   PREMIUM SCRIPT.JS
   ============================ */

/* -------------------------------
   PRELOADER
-------------------------------- */
window.addEventListener("load", () => {
    const preloader = document.getElementById("preloader");
    if (preloader) {
        setTimeout(() => {
            preloader.style.opacity = "0";
            preloader.style.pointerEvents = "none";
        }, 500);
        setTimeout(() => { preloader.style.display = "none"; }, 900);
    }
});

/* -------------------------------
   THEME TOGGLE
-------------------------------- */
const toggleBtn = document.getElementById("theme-toggle");
toggleBtn?.addEventListener("click", () => {
    document.body.classList.toggle("light-mode");

    // store in localStorage
    const mode = document.body.classList.contains("light-mode") ? "light" : "dark";
    localStorage.setItem("portfolio-theme", mode);

    toggleBtn.innerHTML = mode === "light" ? "ðŸŒ™" : "â˜€ï¸";
});

// Load saved theme on start
document.addEventListener("DOMContentLoaded", () => {
    const savedTheme = localStorage.getItem("portfolio-theme");
    if (savedTheme === "light") {
        document.body.classList.add("light-mode");
        toggleBtn.innerHTML = "ðŸŒ™";
    }
});

/* -------------------------------
   REVEAL ANIMATIONS
-------------------------------- */
const revealElements = document.querySelectorAll(".reveal");

function revealOnScroll() {
    revealElements.forEach((el) => {
        const elementTop = el.getBoundingClientRect().top;
        const triggerPoint = window.innerHeight - 120;

        if (elementTop < triggerPoint) {
            el.classList.add("active");
        }
    });
}

window.addEventListener("scroll", revealOnScroll);
revealOnScroll();

/* -------------------------------
   ACTIVE NAV LINK
-------------------------------- */
const sections = document.querySelectorAll("section");
const navLinks = document.querySelectorAll(".navbar a");

window.addEventListener("scroll", () => {
    let current = "";

    sections.forEach((sec) => {
        const top = sec.offsetTop;
        if (pageYOffset >= top - 150) {
            current = sec.getAttribute("id");
        }
    });

    navLinks.forEach((a) => {
        a.classList.remove("active");
        if (a.getAttribute("href").includes(current)) {
            a.classList.add("active");
        }
    });
});

/* -------------------------------
   CONTACT FORM â€“ WEB3FORMS
-------------------------------- */
const contactForm = document.getElementById("contactForm");
const popup = document.getElementById("popup");
const okBtn = document.getElementById("okBtn");

if (contactForm) {
    contactForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(contactForm);

        const res = await fetch("https://api.web3forms.com/submit", {
            method: "POST",
            body: formData
        });

        const result = await res.json();

        if (result.success) {
            popup.style.display = "flex";
            contactForm.reset();
        }
    });
}

okBtn?.addEventListener("click", () => {
    popup.style.display = "none";
});

/* -------------------------------
   OPTIONAL: AUTO FETCH GITHUB PROJECTS
   (Works only if you want this section)
-------------------------------- */

// Change username here
const githubUsername = "basanikavya";

async function loadGitHubRepos() {
    try {
        const res = await fetch(`https://api.github.com/users/${githubUsername}/repos`);
        const repos = await res.json();

        const container = document.getElementById("github-projects");
        if (!container) return;

        container.innerHTML = "";

        repos.slice(0, 6).forEach(repo => {
            container.innerHTML += `
                <div class="project-card reveal">
                    <h3>${repo.name}</h3>
                    <p>${repo.description || "No description available."}</p>
                    <div class="project-links">
                        <a href="${repo.html_url}" target="_blank">GitHub</a>
                    </div>
                </div>
            `;
        });

        revealOnScroll();
    } catch (err) {
        console.log("GitHub fetch failed", err);
    }
}

loadGitHubRepos();
